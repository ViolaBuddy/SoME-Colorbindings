<!DOCTYPE html>
<meta charset="UTF-8">
<html>
<head>
	<title>Colorbindings of Chess Variant Pieces</title>
	<link rel="stylesheet" type="text/css" href="indexstyle.css">
	<script type="text/javascript" src="chess-pieces.js"></script>
	<script type="text/javascript" src="index.js"></script>
	<script type="text/javascript" id="MathJax-script" async
		src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
	</script>
</head>
<body>
<div id="left">
	<fieldset id="boarddivcontrols">
		<legend>Chessboard controls</legend>
		<input type="radio" id="coloring_checkerboard" name="board_coloring" value="coloring_checkerboard" checked="on" /> <label for="coloring_checkerboard">Show standard checkerboard coloring</label><br />
		<input type="radio" id="coloring_colorbinding" name="board_coloring" value="coloring_colorbinding" /> <label for="coloring_colorbinding">Show colorbinding of current piece</label><br />
		<input type="radio" id="coloring_none" name="board_coloring" value="coloring_none" /> <label for="coloring_none">Show no coloring</label>

		<details>
			<summary>Choose piece</summary>
			<dl>
			<dt>Chess</dt>
			<dd>
				<button class='pawn'>Pawn</button>
				<button class='knight'>Knight</button>
				<button class='bishop'>Bishop</button>
				<button class='rook'>Rook</button>
				<button class='queen'>Queen</button>
				<button class='king'>King</button>
			</dd>
			<dt>Shōgi</dt>
			<dd>
				<button class='pawn'>Pawn (Soldier)</button>
				<button class='lance'>Lance</button>
				<button class='laurelhorse'>Laurel Horse</button>
				<button class='silvergeneral'>Silver General</button>
				<button class='goldgeneral'>Gold General</button>
				<button class='bishop'>Bishop</button>
				<button class='rook'>Rook</button>
				<button class='dragonhorse'>Dragon Horse (Promoted Bishop)</button>
				<button class='dragonking'>Dragon King (Promoted Rook)</button>
				<button class='king'>King</button>
			</dd>
			<dt>Xiangqi</dt>
			<dd>
				<button class='pawn'>Pawn (Soldier)</button>
				<button class='promotedsoldier'>Promoted Pawn (Promoted Soldier)</button>
				<button class='rook'>Rook (Chariot)</button>
				<button class='knight'>Knight (Horse)</button>
				<button class='alfil'>Alfil (Elephant)</button>
				<button class='ferz'>Ferz (Advisor)</button>
				<button class='king'>King (General)</button>
				<button class='rook'>Cannon</button>
			</dd>
			<dt>Other Named Pieces from Chess Variants</dt>
			<dd>
				<button class='wazir'>Wazir</button>
				<button class='ferz'>Ferz</button>
				<button class='dabbaaba'>Dabbaaba</button>
				<button class='alfil'>Alfil</button>
				<button class='narrowknight'>Narrow Knight</button>
				<button class='wideknight'>Wide Knight</button>
				<button class='camel'>Camel</button>
				<button class='threeleaper'>Threeleaper</button>
				<button class='dabbaabarider'>Dabbaaba-rider</button>
				<button class='alfilrider'>Alfil-rider</button>
				<button class='nightrider'>Nightrider</button>
				<button class='camelrider'>Camelrider</button>
			</dd>
			<dt>Custom</dt>
			<dd>
				<ul>
					<li><a href="#custom_symmetric">Jump to custom symmetric piece</a></li>
					<li><a href="#custom_reduce">Jump to custom symmetric piece with reduction algorithm</a></li>
					<li><a href="#custom_asymmetric">Jump to custom asymmetric piece</a></li>
				</ul>
			</dd>
			</dl>
			
		</details>

		<br />
		<button id="reset_position">Reset Position</button>
	</fieldset>
	<div id="boardPieceDetails">
		<h3 id="boardPieceName">Pawn</h3>
		<p id="boardPieceDescription"></p>
	</div>
	<div id="boarddivwrapper">
		<div id="boarddiv"></div>
	</div>
</div>
<div id="right">
	<h1>Colorbindings of Chess Variant Pieces</h1>
	<div class="content">
		<h2>Introduction</h2>
		<p>Chess is played by moving pieces around on a square grid. And this is true of xiangqi (Chinese chess) and shōgi (Japanese chess) too. And sure there's, like, strategy and stuff (and in Japanese chess, you can also re-deploy a captured unit), but we can skip that part today. Let's just talk about moving pieces.</p>
		<p>Each chess piece can move in its own unique way. For examples, knights move in a distinctive L-shaped way.  Despite this strange movement, knights can actually reach any square on the board, which I will state without proof here but you can try it for yourself on the left panel by pressing this button: <button class='knight'>Knight</button></p>
		<p>But not all pieces can do that. Obviously, the pawn, as well as some similar pieces that can only move forwards in xiangqi and shōgi, cannot reach tiles behind it. But, also, there's the bishop, which can only reach half the squares on the board&dash;try it out and you'll immediately see why. <button class='pawn'>Pawn</button> <button class='promotedsoldier'>Promoted Soldier (Xiangqi)</button> <button class='lance'>Lance</button> <button class='laurelhorse'>Laurel Horse</button> <button class='bishop'>Bishop</button></p>
		<p>So today I'd like to explore this idea of pieces being only able to move to certain squares. And by "today" I mean "for literally a couple decades now." As a child, I was very into chess variants and thinking about funny new pieces and how they might move, and this idea of being stuck on certain tiles is a common idea among chess variant pieces (also called "fairy chess pieces"). Within this context, this idea is sometimes called <strong>colorbindings</strong>, named after the fact that on an ordinary chessboard, the bishop that starts on one color is stuck to that color and will never leave it. But it turns out that you can construct other pieces (like the alfil <button class='alfil'>Alfil</button>) that have a colorbinding other than just "the light squares" and "the dark squares," so a very natural question is: <strong>what are all the ways that a piece can be colorbound?</strong></p>
		<p>As a child, I never got very far with this question, but now let's see if we can't do a bit better.</p>
	</div>
	<div class="content">
		<h2>Formalizing What We Got</h2>
		<p>First of all, what can a chess variant piece be? People have done really wild and creative things with their chess variants. For example, you <em>could</em> arbitrarily choose a set of tiles on the board and be like "well my new piece, the gobbledygook, can teleport between any of those tiles." But if we allowed that sort of piece, then all possible ways of being colorbound is, trivially, possible, by just declaring any arbitrary set of tiles for the gobbledygook.</p>
		<p>But we can think back to the pieces from the three "canonical" types of chess I mentioned before. In almost all cases, the pieces' movements have translational symmetry: no matter where you are on the board, you can move to the same squares relative to yourself. So for our exploration today, let us only consider pieces whose movements are translationally symmetric.</p>
		<p>We do have to qualify this a little bit. Let's ignore the fact that you're not allowed to move off the edge of a board&mdash;that is, let's consider an infinite board. Let's also assume that no other pieces are on this infinite board&mdash;pawns can't move diagonally to capture, rooks and xiangqi horses aren't blocked by pieces in the way, etc.</p>
		<p>Even under these conditions, there are actually still a few pieces in the three canonical types of chess mentioned that are not translationally symmetric. One is the pawn in Western chess: on the second row ("rank" in chess terms, but I never remember which is rank and which is file), it can move two spaces forward, but if you translate its position up to the third row it cannot make that move. The others are from xiangqi: the general and advisors can only move within the 3x3 palace, and the elephants cannot cross the river. So, again, we're just going to ignore any pieces with these sorts of location restrictions.</p>
		<p>Out of the remaining pieces, we can split their movements into two types: <strong>leapers</strong> and <strong>riders</strong>. Leapers like simply jump to a square a certain offset away from the starting tile. Knights and kings are leapers <button class='king'>King</button>. Riders start like leapers jumping to a square a certain offset away, but then are allowed to continue in that direction (as long as there's nothing in the way, but we're dealing with an empty board, remember) for as long as they like. Rooks and queens are riders <button class='rook'>Rook</button> <button class='queen'>Queen</button>. In fact, we can phrase it as "a queen is a king-rider" to denote that a queen has the same basic movement as the king but can continue riding in the same direction as a single move.</p>
		<p>I will again simply state without proof that a leaper and its corresponding rider have the same colorbinding (i.e. they can reach the same set of squares). As an example that's not just "both pieces can reach the entire board," try playing around with an Alfil and an Alfil-rider: <button class='alfil'>Alfil</button> <button class='alfilrider'>Alfil-rider</button>. Because of this, we can without loss of generality consider only leapers.</p>
		<p>(As an irrelevant aside: you can actually combine leapers and riders, so that you're a rider in some directions and a leaper in others, like the flying dragon and dragon horse in shōgi.) <button class='dragonking'>Dragon King</button> <button class='dragonhorse'>Dragon Horse</button></p>
		<p>We can describe a leaper as a set of moves that it can make. A knight is a <span class="mathjaxcontent">$\left\{(1,2), (1,-2), (-1,-2), (-1,2), (2,1), (2,-1), (-2,-1), (-2,1)\right\}$ leaper. A white pawn (without its double move or capture moves) is a $\{(0,1)\}$</span> leaper, and a black pawn, which moves the other way, is a $\{(0,-1)\}$</span> leaper.</p>
		<p>On that note: rather than the standard letter-and-number system that chess uses for labeling each square on the chessboard, for our infinite chessboard, I'm labeling them $(x,y)$, like the Cartesian plane. And like the Cartesian plane, the positive x-axis is to the right and the positive y-axis is to the top. Unlike the Cartesian plane, we only have integers, none of the in-between fractions or reals.</p>
		<p>For consistency, let's consider the colorbindings of pieces <em>that start on the origin tile</em>, i.e. tile $(0,0)$.</p>
	</div>

	<div class="content">
		<h2>I Smell Group Theory</h2>
		<p>So where do we begin? As a kid there were a lot of ways I tried to think about this, but group theory was not one of them. Because that's not a thing you learn as a kid. But now that I'm coming back to this question, having had an admittedly extremely fast crash course on the subject, I'm definitely feeling group theory vibes from this question. If we set things up right, maybe we can just nab some ideas from group theory to answer our question.</p>
		<p>So let's start by defining some key ideas. A <strong>group</strong> is a set of things and an operation. And indeed, in this case, we have a set of tiles, and each given piece tells you some ways you can move between the tiles, which feels close enough to being an operation.</p>
		<p>But you do need a couple properties to hold for this to properly be considered a set. Rather than apply them to our tiles-and-pieces system immediately, let's start from an easier-to-understand example, the additive group of integers. This is the set of things is all integers $\mathbb{Z}$ and the operation is addition $+$. The three properties of groups that I promised you are:</p>
		<ol>
			<li>The group must be <strong>closed</strong> under the operation. For all elements $a$ and $b$, $a+b$ must also be part of the group. So, like, if you add $3$ and $8$ you'll get another integer; you'll never get something that's not an integer.</li>
			<li>There must be an <strong>identity</strong> element $e$ such that any element $x+e=x$ and $e+x=x$. For addition, our identity element is zero. If you add zero to any integer, you'll get that same integer back.</li>
			<li>For every element $x$ there must be an <strong>inverse</strong> element $x^{-1}$ such that $x + x^{-1}=e$. For addition, that's the negative of a number. $3$ is an integer, so $-3$ must also be an integer.</li>
			<li>The operation must be <strong>associative</strong>. $(a+b)+c = a+(b+c)$. This is obviously true for addition; for example, $(3+4)+9$ and $3+(4+9)$ both equal $16$.</li>
		</ol>
		<p>If you're familiar with the formal properties of addition, there's one property that you've probably noticed is missing from the list: <strong>commutivity</strong>, which is the ability to reorder the arguments. So $4 + 8$ is the same as $8 + 4$. Addition of integers is indeed commutative, but it's not necessary to be classified as a group.</p>
		<p>So back to our "chess board and piece movement" systems. Do these form a group? Well, the way we've numbered the tiles has made it fairly obvious that we're actually just dealing with the cross product of the integers with themselves, $\mathbb{Z} \times \mathbb{Z}$, which is to say "the set of all ordered pairs of integers."</p>
		<p>And not only are tiles elements of this set&mdash;each movement for a piece, like $(2,1)$ for a knight, is an element of it, too! That's good, because then we can define our operation (which we handwaved earlier as "a piece movement-ish thing") more precisely as putting together two elements of our set, one of which we think of as a tile and one of which we think of as our movement.</p>
		<p>And it gets better&mdash;when we say "put together" what we mean by that is that it's just plain integer addition, just on each axis separately. For example, if you start from the $(3,5)$ tile and make the $(2,1)$ move, you'll end up on the $(3,5) + (2,1) = (5,6)$ tile. And we just showed that the integers are a group under regular old addition! So we basically end up inheriting these four properties of groups from the fact that we're just a cross product of two groups&mdash;this is true of any cross product of groups, but I'll leave the details for a proper group theory class.</p>
		<p>(Before group theory fans start coming after me&mdash;technically, when talking about groups and not just sets, we generally call these paired-up groups "direct products," rather than cross or Cartesian products.)</p>
		<p>So we have this mathematical setup for the board. But the thing in particular that we were looking at were colorbindings; how does that translate into group theory language? Well, since it's the set of a piece's <em>accessible</em> tiles, obviously it's a subset of <em>all</em> tiles, which we just said is $\mathbb{Z} \times \mathbb{Z}$. And further, our concept of a movement set of a piece corresponds with the idea of a <strong>generating set</strong>: a set $M$ is said to generate another set $X$ if all elements of $X$ can be expressed as combinations of repeated applications of (possibly different) elements of $M$, and vice versa.</p>
		<p>Some group theory fans are probably complaining again because usually when we're talking about generating sets we're talking not about any old subset of a group, but a special kind of subset of a group called a <strong>subgroup</strong>. A subgroup is exactly what it sounds like, subsets that are themselves groups. So are colorbindings subgroups of $\mathbb Z \times \mathbb Z$? We just have to check the properties above. Associativity comes for free because that's a property of the operation part of the group, not the set part. So we only have to check the other three properties:</p>
		<ol>
			<li>Closure. Remember our definition for this: for all elements $a$ and $b$, $a+b$ must also be part of the group. So consider a tile $b$ that you can reach in some number of moves. If you do that sequence of moves but start from tile $a$ (instead of the origin tile), that would be $a+b$. Is this final destination part of the original group? Well, yes, by our original definition. It's an accessible square because you just accessed it, starting from the origin.</li>
			<li>Identity. The identity for our $+$ operation on $\mathbb{Z} \times \mathbb{Z}$ is the $(0,0)$ origin tile. You start out standing on it, so you've accessed it. Therefore it's in our colorbinding.</li>
			<li>Inverse. That is, if you travel out from the origin to some other square A, you can always find a path all the way back to the origin. But&hellip; that's not actually true. Remember the pawn? You can't undo its moves!</li>
		</ol>
		<p>So in fact, no, a colorbinding of an arbitrary piece isn't a subgroup. Welp. We can do two things with this knowledge: (1) ignore pieces that don't have inverses, or (2) see what we can do even though it's not a group. And in fact, we'll do both, starting with the first.</p>
		<p>(By the way, to please those group theory fans: when talking about generating sets of <em>subgroups</em> in particular, you're also allowed to take inverses of elements while trying to create new elements in the subset. This automatically makes the resulting subset fulfil the third requirement, so it's a subgroup.)</p>
	</div>

	<div class="content">
		<h2>Symmetric pieces and subgroups</h2>
		<p>Let's define the notion of <strong>symmetric pieces</strong> as pieces whose movements come in pairs: for every move (x,y) that it can make, it can also make the move (-x,-y). All five non-pawn pieces in Western chess are symmetric. Shōgi, on the other hand, has a lot of asymmetric pieces: the lance and laurel horse, as mentioned earlier, but also the gold and silver generals. <button class='lance'>Lance</button> <button class='laurelhorse'>Laurel Horse</button> <button class='goldgeneral'>Gold General</button> <button class='silvergeneral'>Silver General</button>. These are pieces we're ignoring in this section.</p>
		<p>Before we dive into the math, let's play around with some of these pieces. Look at the colorbindings for the dabbaaba and the alfil: <button class='dabbaaba'>Dabbaaba</button> <button class='alfil'>Alfil</button>. They're kind of just kind of grid-ish, lines running at right angles to each other. Do all symmetric pieces have this square grid shape to their colorbindings?</p>
		<p>Well, no. It doesn't have to be square because the side lengths don't have to be the same. A piece that's a dabbaaba horizontally but a threeleaper vertically would have a rectangular grid (I'll use <a href="https://www.chessvariants.com/d.betza/chessvar/pieces/notation.html">Ralph Betza's funny notation</a> for naming this more exotic piece without a standard name) <button class='fbHsD'>fbHsD</button>. But even more, the pieces we've been considering all lie on an axis of symmetry of the plane. If you take moves on a different angle, the grid lines skew away from perpendicular to each other. Consider the narrow knight, which is the symmetric extension of shōgi's laurel horse: <button class='narrowknight'>Narrow Knight</button>.</p>
		<p>To some extent, this actually feels pretty natural. All these pieces we've looked at here have two moves in their movement set, plus the inverses of those two moves. So there are two axes of movement, one for each of these moves. As long as the two moves aren't parallel, of course we're going to end up with a grid like this.</p>
		<p>So what happens if we add a third move to our movement set? Can we get something more interesting? Well, try it yourself to see what you can come up with:</p>
		<p id="custom_symmetric">
			<!-- 9007199254740992 is the maximum integer that can be stored as a Javascript Number (a double) without losing precision when you do arithmetic on it: the next storable number is 9007199254740994, skipping over 9007199254740993 -->
			$\{($
			<input type="number" id="customthreemove_11" min="-9007199254740992" max="9007199254740992" value="-2" autocomplete="off"/>
			$,$
			<input type="number" id="customthreemove_12" min="-9007199254740992" max="9007199254740992" value="2" autocomplete="off"/>
			$),$
			<br>
			$($
			<input type="number" id="customthreemove_21" min="-9007199254740992" max="9007199254740992" value="2" autocomplete="off"/>
			$,$
			<input type="number" id="customthreemove_22" min="-9007199254740992" max="9007199254740992" value="2" autocomplete="off"/>
			$),$
			<br>
			$($
			<input type="number" id="customthreemove_31" min="-9007199254740992" max="9007199254740992" value="5" autocomplete="off"/>
			$,$
			<input type="number" id="customthreemove_32" min="-9007199254740992" max="9007199254740992" value="1" autocomplete="off"/>
			$)\}$
			<br>
		 	<button id="customthreemove">Custom Piece</button>
		</p>
		<p id="customthreemove_output"></p>
		<p>I don't know exactly what you came up with, but you probably had coming up with anything that wasn't a parallelogram grid of some kind&mdash;with the pattern maybe messing up at the corners or edges of the board. In fact, that's true. For all symmetric pieces, there always exists some other symmetric piece with at most two moves (and their inverses) with the same colorbinding.</p>
		<p>How can we prove this? Well, we can actually take a page out of linear algebra. Anyone who's familiar with linear algebra may have already felt the similarity&mdash;it feels like we're in a 2D vector space and we're trying to find the span of vectors. It's just that we now live in a quantized integer world, not one with coordinates that can freely vary through all real numbers. But if you're not familiar with it, that's okay too; we're going to go through this together.</p>
		<p>Let's consider the symmetric piece that can move to $\{(3,2), (4,3), (5,1)\}$ (and remember that, as a symmetric piece, it can go to the inverses of these as well). We want to show that there's another symmetric piece, $\{(x_1,y_1), (x_1, y_2)\}$, with only two moves in its movement set, that has the same colorbinding, i.e. these sets generate the same subgroup of $\mathbb Z \times \mathbb Z$.</p>
		<p>We can start by pointing out that if a piece $\{a, b, c\}$ generates a colorbinding, then the piece $\{a, b, c+a\}$ also generates the same colorbinding. In particular, consider any tile in the colorbinding that requires that we add $c$ to the path somewhere to get to it. With our new piece, instead, we can add $c+a$ and then $-a$ where we would have added $c$. Thus, if we could find a path to a tile with our first piece, we can also find a path to our second tile.</p>
		<p>We can of course extend this to say that all of the following have the same colorbinding: $\{a, b, c+b\}$, $\{a, b, c-a\}$, $\{a, b, c+2a\}$, $\{a+c, b, c\}$. That is, we can add any multiple of one movement in our movement set to any other movement, and we would still get the same colorbinding. And we can compose this: first you might add the first move to the third, and then you might subtract this new third from the second, and then you might subtract that all from the first.</p>
		<p>Unlike with vectors, you cannot add a movement <em>to itself</em>. When we added $a$ to another vector $c$, we required that the original $a$ stay intact, so that we can use it to "undo" that addition later. But if you add $a$ to itself, you end up destroying the original copy of $a$. Anecdotally, we've already see this&mdash;a dabbaaba and a wazir have different colorbindings! <button class='dabbaaba'>Dabbaaba</button> <button class='wazir'>Wazir</button></p>
		<p>Now we have a way to find other pieces with three moves that have the same colorbindings as an initial three-move piece. Do you see how we could use this to <em>reduce</em> the number of moves to two? Well, one thing to note is that if $(0,0)$, the identity element, is one of the three moves, we can remove it and it wouldn't change the colorbinding. After all, it can never add any new tiles no matter how many times you add that movement.</p>
		<p>So our plan is to figure out a way to do this "adding moves to each other" thing repeatedly until we can get one of the moves to the zero move. For convenience, let's throw the moves into a matrix, one on each row. So in our original example, we start with the following matrix: $$\begin{bmatrix}
			3 & 2\\
			4 & 3\\
			5 & 1
		\end{bmatrix}$$</p>
		<p>What we're doing is a process from linear algebra called <strong>Gaussian elimination</strong> to make this matrix into <strong>row echelon form</strong>. This means each row in the matrix has strictly more zeros at the start of it than the row above it (exception: you're allowed to have the same number of zeros as the row above you if the entire row is already zeros). For example, the following matrices are all in row echelon form: $$\begin{bmatrix}
			4 & 1 \\
			0 & -9\\
			0 & 0
		\end{bmatrix}, \begin{bmatrix}
			4 & 1 \\
			0 & 0\\
			0 & 0
		\end{bmatrix}, \begin{bmatrix}
			4 & 1 & 0\\
			0 & 2 & 2\\
			0 & 0 & 4
		\end{bmatrix}, \begin{bmatrix}
			4 & 1 & 0\\
			0 & 0 & 2\\
			0 & 0 & 0\\
			0 & 0 & 0
		\end{bmatrix}$$</p>
		<p>You can see why this is useful for us: in row echelon form, if each row has to have strictly more zeros than the row above it, then at some point you run out of columns to have zeros in and you have to be all zeros, which is what we're looking for!</p>
		<p>In linear algebra, it's easy to add something to the second and third row to get zero in the first column, because you can multiply by any number. So for example, if we pretend our matrix is from ordinary linear algebra land (i.e. in $\mathbb R \times \mathbb R$), we could do:$$\begin{aligned}
		\begin{bmatrix}
			3 & 2\\
			4 & 3\\
			5 & 1
		\end{bmatrix}\xrightarrow{\text{add}\left(\frac{-4}{3}\times\text{row 1}\right) \text{ to row 2}}&\begin{bmatrix}
			3 & 2\\
			4-4 & 3 - \frac{8}{3}\\
			5 & 1
		\end{bmatrix} = \begin{bmatrix}
			3 & 2\\
			0 & \frac{1}{3}\\
			5 & 1
		\end{bmatrix}\\
		\xrightarrow{\text{add}\left(\frac{-5}{3}\times\text{row 1}\right) \text{ to row 3}}&\begin{bmatrix}
			3 & 2\\
			0 & \frac{1}{3}\\
			5 - 5 & 1 - \frac{10}{3}
		\end{bmatrix} = \begin{bmatrix}
			3 & 2\\
			0 & \frac{1}{3}\\
			0 & -\frac{7}{3}
		\end{bmatrix}
		\end{aligned}$$ </p>
		<p>And from here we can do a similar thing for the second column. But again, we're stuck with integers so we have to find our zeros a different way.</p>
		<p>This actually stumped me for a little bit, but actually, it turns out that there's an algorithm from number theory that does exactly what we're looking for, reduce a number down to zero by adding and subtracting back and forth. So now that we've touched on group theory and linear algebra, it's time to add a third area of math to this, number theory.</p>
		<p>The reason why I didn't realize this was what I was looking for at first is that this algorithm isn't normally thought of as "thing that brings a number down to zero". It's Euclid's algorithm, and normally it's useful because it finds the GCF (greatest common factor) between two natural numbers. The algorithm itself is also extremely simple: if you have two numbers, subtract the smaller one from the larger one and repeat until one of them is zero. The other number will be the GCF (I won't explain why because it's not relevant to us now, but <a href="https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/the-euclidean-algorithm">here</a> is an article from Khan Academy about it).</p>
		<p>There's a further modification, in that we're doing this on rows with two numbers each. We're doing Euclid's algorithm on the numbers in the first column, and the second column is just coming along for the ride. An example will probably make that clear:$$\begin{aligned}
		\begin{bmatrix}
			3 & 2\\
			4 & 3\\
			5 & 1
		\end{bmatrix}\xrightarrow{\text{subtract row 1 from row 2}} &\begin{bmatrix}
			3 & 2\\
			4-3 & 3-2\\
			5 & 1
		\end{bmatrix} = \begin{bmatrix}
			3 & 2\\
			1 & 1\\
			5 & 1
		\end{bmatrix}\\
		\xrightarrow{\text{subtract row 2 from row 1, three times}} &\begin{bmatrix}
			3-3 & 2-3\\
			1 & 1\\
			5 & 1
		\end{bmatrix} = \begin{bmatrix}
			0 & -1\\
			1 & 1\\
			5 & 1
		\end{bmatrix}
		\end{aligned}$$</p>
		<p>And we actually ended up with the zero in the top row rather than in the second row. Euclid's algorithm makes no guarantee which of the two rows will end up as zero, only that one of them will. But remember our matrix is just our movement set, thrown in in any which order; we can always swap rows around because it's not like our $(0,1)$ move has any sort of priority over our $(1,1)$ move. So let's do that, and then repeat Euclid's algorithm between our first and third rows to get one of them down to zero (which is admittedly quite easy):$$\begin{aligned}
		\begin{bmatrix}
			0 & -1\\
			1 & 1\\
			5 & 1
		\end{bmatrix}\xrightarrow{\text{swap rows 1 and 2}} &\begin{bmatrix}
			1 & 1\\
			0 & -1\\
			5 & 1
		\end{bmatrix}\\
		\xrightarrow{\text{subtract row 1 from row 3, five times}} &\begin{bmatrix}
			1 & 1\\
			0 & -1\\
			5-5 & 1-5
		\end{bmatrix} = \begin{bmatrix}
			1 & 1\\
			0 & -1\\
			0 & -4
		\end{bmatrix}
		\end{aligned}$$</p>
		<p>At this point it's pretty obvious that you can move to tile $(0, -4)$ using only $(0,-1)$ moves, but just to be systematic about this, we can repeat Euclid's algorithm on the second column of rows 2 and 3 to get a zero. Euclid's algorithm only works on positive integers, but that's okay because we're still working with symmetric pieces right now, so we can invert any row.$$\begin{aligned}
		\begin{bmatrix}
			1 & 1\\
			0 & -1\\
			0 & -4
		\end{bmatrix}\xrightarrow{\text{invert row 2}} &\begin{bmatrix}
			1 & 1\\
			0 & 1\\
			0 & -4
		\end{bmatrix}\\
		\xrightarrow{\text{invert row 3}} &\begin{bmatrix}
			1 & 1\\
			0 & 1\\
			0 & 4
		\end{bmatrix}\\
		\xrightarrow{\text{subtract row 2 from row 3, four times}} &\begin{bmatrix}
			1 & 1\\
			0 & 1\\
			0 & 4-4
		\end{bmatrix} = \begin{bmatrix}
			1 & 1\\
			0 & 1\\
			0 & 0
		\end{bmatrix}
		\end{aligned}$$</p>
		<p>And there we have it. Our original piece with a symmetric movement set of $\{(3,2),(4,3),(5,1)\}$ has the same colorbinding as a piece with a symmetric movement set of $\{(1,1),(0,1),(0,0)\}$, and as we said, we can always remove $(0,0)$ from a movement set, so we can get $\{(1,1),(0,1)\}$. <button class='example1'>Example piece $\{(3,2),(4,3),(5,1)\}$</button> <button class='reducedexample1'>Reduced example piece $\{(1,1),(0,1)\}$</button>. (Please note that with this example, we run into edge effects in the corners of a finite board where these awkward movements get caught. On an infinite board, we would be able to reach all tiles with both pieces.)</p>
		<p>And there was nothing special about our original piece here. Any symmetric leaper with more than two movements in its movement set can be reduced in the same way down to something with at most two movements. And pieces with two moves in their movement sets have a grid-like colorbinding, as we saw. So <strong>all symmetric leapers have colorbindings that are parallelogram grids</strong>. Well, actually, some pieces may end up reducing down to a piece with only one movement. You'd end up with a degenerate parallelogram grid in that case. But I'll let you play around with that, because here is a calculator for pieces with up to four movements. What's filled in by default is a degenerate case:</p>
		<p id="custom_reduce">
			<input type="number" id="symmetric_11" min="-9007199254740992" max="9007199254740992" value="3" autocomplete="off"/>
			<input type="number" id="symmetric_12" min="-9007199254740992" max="9007199254740992" value="2" autocomplete="off"/>
			<br>
			<input type="number" id="symmetric_21" min="-9007199254740992" max="9007199254740992" value="6" autocomplete="off"/>
			<input type="number" id="symmetric_22" min="-9007199254740992" max="9007199254740992" value="4" autocomplete="off"/>
			<br>
			<input type="number" id="symmetric_31" min="-9007199254740992" max="9007199254740992" value="-6" autocomplete="off"/>
			<input type="number" id="symmetric_32" min="-9007199254740992" max="9007199254740992" value="-4" autocomplete="off"/>
			<br>
			<input type="number" id="symmetric_41" min="-9007199254740992" max="9007199254740992" value="0" autocomplete="off"/>
			<input type="number" id="symmetric_42" min="-9007199254740992" max="9007199254740992" value="0" autocomplete="off"/>
			<br>
			<input type="button" value="Go!" id="symmetric_go_btn" />
		</p>
		<p id="symmetric_output"></p>
		<p>So we're done here, at least for symmetric pieces.</p>
		<p>Credit where credit was due: <a href="https://math.stackexchange.com/a/193942">this answer on the Math StackExchange</a> was a big part of where I got this reasoning from. Also thanks to the SoME3 Discord who helped me figure out that Euclid's algorithm was the key idea.</p>
	</div>
	<div class="content">
		<h2>Asymmetric pieces</h2>
		<p>So now, armed with this Gaussian elimination trick, we come back to asymmetric pieces. Can we do a similar thing, algorithmically reducing an asymmetric movement set down to a smaller set?</p>
		<p>Well, when we lose symmetry, what in our Gaussian elimination trick fails? One place is obvious: we can't invert a row at will, since the inversion of a row is no longer implied to exist. But another sneakier place is the more fundamental idea that $\{a, b\}$, $\{a, a+b\}$, and $\{a, a-b\}$ all have the same colorbinding. If you can get to somewhere with a sequence of $a$'s and $b$'s, you cannot replace each $b$ with $a+b$ followed by $-a$, because of course $-a$ doesn't exist. On the converse, you <em>can</em> replace $b$'s with $a-b$ followed by $a$, so we're okay here&mdash;but that doesn't actually mean that the colorbindings are the same, only that the first is a <em>subset</em> of the latter. If we consider a sequence of $a$'s and $a-b$'s instead and try to replicate it with only $a$'s and $b$'s, we end up unable to do so.</p>
		<p>With that idea gone, Gaussian elimination is completely out the window. So what other ways are there of reducing a large number of moves to a smaller number? <em>Is</em> there such a way?</p>
		<p>But in fact, no, we cannot. Or at least, not in general, not to something manageable. Because we can construct a piece with any arbitrary number of moves, and yet no way to reduce that moveset down without changing the colorbinding. Consider the piece that can move to $\{(1,1),(1,2),(1,3),(1,4),\ldots, (1,n)\}$, basically jumping to any of the first $n$ spaces in the next column over. This basically just creates rays going out from the origin at slopes $1, 2, 3, 4, \ldots, n$. So obviously any piece with the same colorbinding must only have moves in the "first quadrant" (moves with strictly positive $x$ and $y$ components), since our colorbinding doesn't include anything in the other quadrants. But then, if that's the case, the only way to reach any tiles in column $1$ is to jump there directly, since you can't go backwards so you can't overshoot the first column and then come back. So if we have to cover all $n$ tiles in the first column, then we have to have all $n$ different moves.</p>
		<p>(With symmetric pieces, even just $\{(1,1),(1,2)\}$ is enough to reach every possible space on the board.)</p>
		<p>So then&hellip; what are we even looking for? We can name every possible symmetric piece colorbinding with a pair of moves. Sure, some of them are going to have the same colorbindings ($\{a, b\}$ and $\{a, a+b\}$ have the same colorbindings, remember), but the space of pairs of moves still feels a lot more manageable&mdash;and we even can qualitatively describe these as parallelogram grids. But with asymmetric piece colorbindings, we cannot reduce all movesets to a pair of moves, or a triplet of moves, or even a set of a million moves. I think we're kind of out of luck.</p>
		<p>At least, that's true if we're trying specifically to reduce a moveset down to a specific number of moves. But can we at least describe qualitatively what these colorbindings are like?</p>
		<p>We can start by saying they're subsets of their symmetric counterparts. That's obvious. If an asymmetric piece can get somewhere, then the asymmetric piece can too, by following the same moves. So we're restricted to a grid-like tile, but possibly just a section of it. This is most obvious with something like the Laurel Horse vs. the Narrow Knight, though when not all of your moves are in the same general direction, it's not necessarily immediately obvious what subset we're going to end up with. <button class='laurelhorse'>Laurel Horse</button> <button class='narrowknight'>Narrow Knight</button></p>
		<p>On the note of being in the same direction&mdash;when you have just two asymmetric moves, you end up with a wedge of the corresponding symmetric piece's grid, the one that sits in between the two axes. If you have more than two asymmetric moves, but all pairs of moves have wedges that lie within the same 180 degrees, then all tiles in the colorbinding lie in that 180 degrees.</p>
		<p>At this point, I really am quite stuck at trying to describe possibilities. It's likely there are more things to say about it, even in ways that are more rigorous than just these qualitative descriptions, but I've had trouble getting anywhere further with this&mdash;I'd love to hear more ideas if you have any.</p>
		<p>But putting asymmetric pieces aside, I do have one last thing to say, and it brings us right back to group theory.</p>
		<p>Before we move to that, though I need to credit <a href="https://math.stackexchange.com/questions/590159/submonoids-of-mathbbnk">another Stack Overflow answer</a> here, which is about the submonoids of $\mathbb N^2$. It's not exactly the same problem as the asymmetric colorbindings that we're talking about, but it's close enough that its construction of $\{(1,n)\}$ for all $n$ works as a counterexample for our situation, too. It also talks about a concept which I didn't mention of <strong>finitely generated</strong>. I never actually specified if a piece is allowed to have an infinite number of moves in its moveset, so didn't touch on this.</p>
	</div>
	<div class="content">
		<h2>Cosets: how many copies of a piece do you need to fill the plane?</h2>
		<p>All right, so back to the much more well-behaved symmetric pieces. We've been starting pieces always from the origin. But in a real game of chess, your two bishops start on different squares. Although no one bishop can visit all squares, the two of them together can visit any square. Ralph Betza on chessvariants.com calls it the <a href="https://www.chessvariants.com/d.betza/pieceval/jacksprat.html">Jack Sprat principle</a>. <button class="bishop">Bishop</button></p>
		<p>But not all pieces require only two pieces to cover the entire board. Obviously, pieces that can cover the entire board like the wazir just need that one piece. Meanwhile, something like the dabbaaba requires four.</p>
		<p>The concept we're looking for is called <strong>cosets of a subgroup</strong> in group theory; for our purposes I'll call them <strong>co-colorbindings</strong> (but usually in chess variant talk, they're just also called colorbindings). It's the set of squares that a piece can access starting from any particular square, not just the origin. By the way, this means that the origin isn't (in general) a part of the set anymore. This is why it's a coset and not a cogroup, by the way, since we no longer have the identity element.</p>
		<p>It's always true that the plane can be partitioned exactly into cosets (i.e. colorbindings). That's not necessarily immediately obvious&mdash;what if you tried filling in the plane with colorbindings, and then end up with just a few squares that are unaccounted for?&mdash;but it is a true fact from group theory that I won't prove here.</p>
		<p>But our question now is: if we have a given symmetric piece's colorbinding, how many co-colorbindings does it have?</p>
		<p>Well, remember that we showed above that any symmetric piece can be reduced to an equivalent piece of the form $\{(a,b), (0,d)\}$. So let's consider one example piece: <button class='example2'>Example piece $\{(3,2),(0,6)\}$</button>. We keep talking about a parallelogram grid with symmetric pieces, and here's where this becomes more relevant. In our example piece, one parallelogram of our grid is the one from $(0,0)$ to $(3,2)$ to $(3,8)$ to $(0,6)$. This is kind of the "base" parallelogram of the grid, the one containing the two vectors in our moveset.</p>
		<p>With our original piece, starting from the origin, we cannot hit any of the points on the interior of the parallelogram, only on the corners. So we need more co-colorbinding for the tiles on the interior of the parallelogram. I will claim, with the ever-annoying proof of "proof by it's visually obvious," that each tile on the interior of the parallelogram needs a <em>different</em> co-colorbinding; no co-colorbinding will cover more than one tile inside our parallelogram. So our answer is simply the area of the parallelogram; that's how many co-colorbindings that exist.</p>
		<p>Because we're working with square tiles (i.e. $\mathbb Z \times \mathbb Z$), rather than the much more familiar  $\mathbb R \times \mathbb R$, it's not immediately obvious what I mean by the area. I'm including the bottom and left sides of the parallelogram, but not the top or right. But even then&mdash;the bottom of the parallelogram is at a sort of funny angle that doesn't really pass through any real tiles.</p>
		<p>But we can actually take advantage of the fact that the area of a parallelogram doesn't change if you skew it. So instead of the the aforementioned parallelogram, we can make it into the rectangle from $(0,0)$ to $(3,0)$ to $(3,6)$ to $(0,6)$. Every tile in there (including the bottom and left, not including the top or right) requires a different co-colorbinding to be accessible. So if we want to Jack Sprat the board with this funny example piece, we would need eighteen distinct copies of the piece. Equivalently, if we want to color the chessboard board according to these co-colorbindings, rather than the co-colorbindings of a bishop, we would need eighteen colors rather than two.</p>
		<p>And this does generalize to other pieces. For any piece that can be reduced to $\{(a,b), (0,d)\}$, it has $a\cdot d$ co-colorbindings. (Why doesn't $b$ matter? Consider again the parallelogram skewing.) Actually, there is one edge case where this isn't true: if $a=0$ or $d = 0$, and the area of the parallelogram is zero. But I'll leave that edge case up to you to figure out, and ignore it.</p>
		<p>If you'll allow me to abstract a little bit further before I let you go: these co-colorbindings themselves form a group. That is, each element of this new meta-group is itself an entire co-colorbinding. But that's hard to think about, so we usually think about the co-colorbindings as having representative tiles, the tile on the "base rectangle" that we constructed above. So for example, the original colorbinding is also known as the $(0,0)$ co-colorbinding, since it's the co-colorbinding of a piece that starts on the origin. But there's also the $(1,0)$ co-colorbinding, the $(2,0)$ co-colorbinding, the $(2,4)$ co-colorbinding, etc. And if we ever do something that produces a tile outside the base rectangle, we can just replace it with the tile within the base rectangle in the same co-colorbinding&mdash;that is, the $(3,6)$ co-colorbinding is the same thing as the $(0,0)$ co-colorbinding. (This is a 2D version of modular arithmetic, in case you're familiar with that.)</p>
		<p>You can check the four properties of the group if you want, but I'll take it as a given that this is in fact a well-formed group (this is a result from group theory for all normal subgroups. What "normal" means is beyond the scope of this article, but I'll just say that the colorbindings we're looking at are all normal subgroups). What this means is&hellip; we can do a lot of the same things we just did, but on this meta-group instead! Define "meta-pieces" that move between co-colorbindings rather than between tiles.</p>
		<p>This is all fun and abstract, but there is at least one way this can be useful for finding colorbindings. Because instead of needing to deal with the infinite number of tiles in $\mathbb Z \times \mathbb Z$, we now have a finite group. We can brute force things a lot more easily now. And moreover, the group loops back on itself, in a modular arithmetic-y kind of way. So those asymmetric pieces that just kind of ran off to infinity before no longer do. They're going to be a lot more well-behaved.</p>
		<p>Of course, we do need to start with a symmetric piece in order to be able to use this "group of co-colorbindings" as a starting point at all. So let's say we have a symmetric piece like this, to which we add a single asymmetric move. What is the colorbinding of the final combined piece? By adding the asymmetric move, we're basically linking up the symmetric co-colorbindings, and putting them together in the same colorbindings. For example, add the asymmetric move $(1,2)$ to the example piece we've been working with in this section. The co-colorbinding at $(0,0)$ is connected to the co-colorbinding at $(1,2)$, because with this additional asymmetric move you can get to anything in the $(1,2)$ co-colorbinding. But you can also repeat the asymmetric move to connect the $(0,0)$ and $(1,2)$ co-colorbindings to the $(2,4)$ co-colorbinding. And then once more to get to the $(3,6)$ co-colorbinding&mdash;but that's just the same as $(0,0)$ co-colorbinding! So even by only going forward along our asymmetric $(1,2)$ move, we can actually move from any of these three co-colorbindings to any of the others. Our final piece's colorbinding is thus a combination of all three of these co-colorbindings.</p>
		<p>An asymmetric move being added to a symmetric piece is perhaps a fairly specific case, but it's a good way of thinking of the Silver General, at least. It's an asymmetric $(0,1)$ move added to the ferz. The ferz of course only has two co-colorbindings, but this asymmetric move links the two co-colorbindings together, and that's why the Silver General can move to every tile on the board. <button class="silvergeneral">Silver General</button> <button class="ferz">Ferz</button></p>
	</div>
	<div class="content">
		<h2>In conclusion</h2>
		<p>The question we set out to answer, "what are all possible colorbindings of arbitrary leapers?" we found a little bit too difficult to answer completely. We get a very nice answer when we limit ourselves to symmetric leapers: they can always be reduced down to a parallelogram grid of two "vectors." And we can use that fact to answer an offshoot question, "how many copies of a symmetric piece do we need to be able to reach the entire board?"</p>
		<p>As for the ever-annoying asymmetric pieces&hellip;it <em>feels</em> like there are a lot more patterns and structure in their colorbindings. But I'm really quite stuck here. Monoids are just not as well-behaved (nor as well-asked about on Stack Overflow) as groups. Again, if any of you have more ideas, I'd love to hear them.</p>
		<p>But even if it's technically not a complete answer, the ten-year-old in me who still loves looking up chess variants and thinking about symmetries of a chessboard is happy to have any answer at all. This is something I've been thinking about on and off since that time, and it's really cool that the answer isn't trivial (either because the set of possible colorbindings is too small to be interesting or because the set of possible colorbindings is so big as to be basically "all possible subsets" without anything interesting to explore). And it was really cool that it touches on some deeper math topics (we had a bit of group theory, a bit of linear algebra, a bit of number theory) that aren't even necessarily <em>that</em> difficult but are certainly beyond what a ten-year-old would be able to figure out, even though it was ten-year-old me who original posed the question.</p>
	</div>

	<hr>
	<h1>Acknowledgments</h1>
	<div class="content">
		<p>This page was created by Viola Buddy for the Summer of Math Exposition 3 (SoME3), an event organized by the YouTube channel 3Blue1Brown (among others) to encourage people to create explanations of math or math-related subjects in any online medium. This page was written in HTML/Javascript, with equations written using the <a href="https://www.mathjax.org/">MathJax</a> library.</p>
	</div>
<script type="text/javascript">
	window.MathJax = {
	  tex: {
	    inlineMath: [['$', '$'], ['\\(', '\\)']]
	  }
	};

	main();

	// symmetric leapers
	const WAZIR = [ [1,0],[0,1],[-1,0],[0,-1] ];
	const FERZ = [ [1,1],[1,-1],[-1,1],[-1,-1] ];
	const DABBAABA = [ [2,0],[0,2],[-2,0],[0,-2] ];
	const ALFIL = [ [2,2],[2,-2],[-2,2],[-2,-2] ];
	const THREELEAPER = [ [3,0],[0,3],[-3,0],[0,-3] ];
	const KNIGHT = [ [1,2],[1,-2],[-1,2],[-1,-2],[2,1],[2,-1],[-2,1],[-2,-1] ];
	const CAMEL = [ [1,3],[1,-3],[-1,3],[-1,-3],[3,1],[3,-1],[-3,1],[-3,-1] ];
	const KING = WAZIR.concat(FERZ);
	const fbHsD = [ [2,0],[0,3],[-2,0],[0,-3] ];
	const NARROWKNIGHT = [ [1,2],[1,-2],[-1,2],[-1,-2] ];
	const WIDEKNIGHT = [ [2,1],[-2,1],[2,-1],[-2,-1] ];

	// symmetric riders and combination rider-leapers
	const ROOK = [ [1,0,MovementCategory.Rider],[0,1,MovementCategory.Rider],[-1,0,MovementCategory.Rider],[0,-1,MovementCategory.Rider] ];
	const BISHOP = [ [1,1,MovementCategory.Rider],[1,-1,MovementCategory.Rider],[-1,1,MovementCategory.Rider],[-1,-1,MovementCategory.Rider] ];
	const DABBAABARIDER = [ [2,0,MovementCategory.Rider],[-2,0,MovementCategory.Rider],[0,2,MovementCategory.Rider],[0,-2,MovementCategory.Rider] ];
	const ALFILRIDER = [ [2,2,MovementCategory.Rider],[2,-2,MovementCategory.Rider],[-2,2,MovementCategory.Rider],[-2,-2,MovementCategory.Rider] ];
	const NIGHTRIDER = [ [1,2,MovementCategory.Rider],[1,-2,MovementCategory.Rider],[-1,2,MovementCategory.Rider],[-1,-2,MovementCategory.Rider],[2,1,MovementCategory.Rider],[2,-1,MovementCategory.Rider],[-2,1,MovementCategory.Rider],[-2,-1,MovementCategory.Rider] ];
	const CAMELRIDER = [ [1,3,MovementCategory.Rider],[1,-3,MovementCategory.Rider],[-1,3,MovementCategory.Rider],[-1,-3,MovementCategory.Rider],[3,1,MovementCategory.Rider],[3,-1,MovementCategory.Rider],[-3,1,MovementCategory.Rider],[-3,-1,MovementCategory.Rider] ];
	const QUEEN = ROOK.concat(BISHOP);
	const DRAGONKING = ROOK.concat(FERZ);
	const DRAGONHORSE = BISHOP.concat(WAZIR);

	// asymmetric leapers and riders
	const PAWN = [ [0,1] ];
	const PROMOTEDSOLDIER = [ [1,0],[0,1],[-1,0] ];
	const LANCE = [ [0,1,MovementCategory.Rider] ];
	const LAURELHORSE = [ [1,2],[-1,2] ];
	const SILVERGENERAL = [ [1,1],[1,-1],[-1,1],[-1,-1],[0,1] ];
	const GOLDGENERAL = [ [1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1] ];

	// special
	const EXAMPLE1 = [ [3,2],[-3,-2],[4,3],[-4,-3],[5,1],[-5,-1] ];
	const REDUCEDEXAMPLE1 = [ [1,1],[0,1],[-1,-1],[0,-1] ];

	const ALL_MOVEMENTS_DICT = {
		'wazir': WAZIR,
		'ferz': FERZ,
		'dabbaaba': DABBAABA,
		'alfil': ALFIL,
		'threeleaper': THREELEAPER,
		'knight': KNIGHT,
		'camel': CAMEL,
		'king': KING,
		'fbHsD': fbHsD,
		'narrowknight': NARROWKNIGHT,
		'wideknight': WIDEKNIGHT,

		'rook': ROOK,
		'bishop': BISHOP,
		'dabbaabarider': DABBAABARIDER,
		'alfilrider': ALFILRIDER,
		'nightrider': NIGHTRIDER,
		'camelrider': CAMELRIDER,
		'queen': QUEEN,
		'dragonking': DRAGONKING,
		'dragonhorse': DRAGONHORSE,

		'pawn': PAWN,
		'promotedsoldier': PROMOTEDSOLDIER,
		'lance': LANCE,
		'laurelhorse': LAURELHORSE,
		'silvergeneral': SILVERGENERAL,
		'goldgeneral': GOLDGENERAL,

		'example1': EXAMPLE1,
		'reducedexample1': REDUCEDEXAMPLE1,
	}
	const ALL_NAMES_DICT = {
		'wazir': 'Wazir',
		'ferz': 'Ferz',
		'dabbaaba': 'Dabbaaba',
		'alfil': 'Alfil',
		'threeleaper': 'Threeleaper',
		'knight': 'Knight',
		'camel': 'Camel',
		'king': 'King',
		'fbHsD': 'fbHsD',
		'narrowknight': 'Narrow Knight',
		'wideknight': 'Wide Knight',

		'rook': 'Rook',
		'bishop': 'Bishop',
		'dabbaabarider': 'Dabbaaba-rider',
		'alfilrider': 'Alfil-rider',
		'nightrider': 'Nightrider',
		'camelrider': 'Camelrider',
		'queen': 'Queen',
		'dragonking': 'Dragon King',
		'dragonhorse': 'Dragon Horse',

		'pawn': 'Pawn/Soldier',
		'promotedsoldier': 'Promoted Soldier',
		'lance': 'Lance',
		'laurelhorse': 'Laurel Horse',
		'silvergeneral': 'Silver General',
		'goldgeneral': 'Gold General',

		'example1': 'Symmetric Piece $\{(3,2),(4,3),(5,1)\}$',
		'reducedexample1': 'Symmetric Piece $\{(1,1),(0,1)\}$',
	}

	// TODO
	const ALL_DESCRIPTIONS_DICT = {
		'wazir': 'Wazir',
		'ferz': 'Ferz',
		'dabbaaba': 'Dabbaaba',
		'alfil': 'Alfil',
		'threeleaper': 'Threeleaper',
		'knight': 'Knight',
		'camel': 'Camel',
		'king': 'King',
		'fbHsD': 'fbHsD',
		'narrowknight': 'Narrow Knight',
		'wideknight': 'Wide Knight',

		'rook': 'Rook',
		'bishop': 'Bishop',
		'dabbaabarider': 'Dabbaaba-rider',
		'alfilrider': 'Alfil-rider',
		'nightrider': 'Nightrider',
		'camelrider': 'Camelrider',
		'queen': 'Queen',
		'dragonking': 'Dragon King',
		'dragonhorse': 'Dragon Horse',

		'pawn': 'Pawn/Soldier',
		'promotedsoldier': 'Promoted Soldier',
		'lance': 'Lance',
		'laurelhorse': 'Laurel Horse',
		'silvergeneral': 'Silver General',
		'goldgeneral': 'Gold General',

		'example1': 'Symmetric Piece $\{(3,2),(4,3),(5,1)\}$',
	}

	for(let thisBtn of document.querySelectorAll('button')) {
		for (let [movementName, movement] of Object.entries(ALL_MOVEMENTS_DICT)) {
			if (!thisBtn.classList.contains(movementName))
				continue;

			thisBtn.addEventListener('click', function(event){
				thePiece.moves = movement;
				mainBoard.resetAll();
				mainBoard.addPiece(thePiece, zeroRow, zeroCol);
				mainBoard.setSelectedTile(zeroRow, zeroCol);
				mainBoard.updateDomToMatchState();

				let boardPieceNameDiv = document.getElementById('boardPieceName');
				let boardPieceDescriptionDiv = document.getElementById('boardPieceDescription');

				boardPieceNameDiv.innerHTML = ALL_NAMES_DICT[movementName];
				boardPieceDescriptionDiv.innerHTML = ALL_DESCRIPTIONS_DICT[movementName];

				MathJax.typeset();
			});
		}
	}

	document.getElementById('customthreemove').addEventListener('click', function(event){
		const array_ids = [
			['customthreemove_11', 'customthreemove_12'],
			['customthreemove_21', 'customthreemove_22'],
			['customthreemove_31', 'customthreemove_32'],
		];
		let array_elements = array_ids.map(row =>
			row.map( id =>
				parseInt(document.getElementById(id).value)
			)
		);
		// check validity
		if (array_elements.some(row =>
				row.some(element =>
					!Number.isInteger(element)
				)
			)) {
			document.getElementById('customthreemove_output').innerHTML = '⚠️ error parsing input ⚠️';
			return;
		}

		let movement = array_elements.concat(
				array_elements.map(row => row.map( id => -id))
			);

			thePiece.moves = movement;
			mainBoard.resetAll();
			mainBoard.addPiece(thePiece, zeroRow, zeroCol);
			mainBoard.setSelectedTile(zeroRow, zeroCol);
			mainBoard.updateDomToMatchState();
	});

	document.getElementById('symmetric_go_btn').addEventListener('click', function(event){
		const array_ids = [
			['symmetric_11', 'symmetric_12'],
			['symmetric_21', 'symmetric_22'],
			['symmetric_31', 'symmetric_32'],
			['symmetric_41', 'symmetric_42'],
		];
		let array_elements = array_ids.map(row =>
			row.map( id =>
				parseInt(document.getElementById(id).value)
			)
		);
		// check validity
		if (array_elements.some(row =>
				row.some(element =>
					!Number.isInteger(element)
				)
			)) {
			document.getElementById('symmetric_output').innerHTML = '⚠️ error parsing matrix ⚠️';
			return;
		}

		let matrix_4x2_to_latex = function(matrix){
			let output = '\\begin{bmatrix}';

			output += matrix[0][0];
			output += '&';
			output += matrix[0][1];
			output += '\\\\';

			output += matrix[1][0];
			output += '&';
			output += matrix[1][1];
			output += '\\\\';

			output += matrix[2][0];
			output += '&';
			output += matrix[2][1];
			output += '\\\\';

			output += matrix[3][0];
			output += '&';
			output += matrix[3][1];

			output += '\\end{bmatrix}';
			return output;
		};

		/** three elementary row operation functions. Does it in-place, and returns a string.*/
		let swap_rows = function(matrix, r1, r2) {
			[matrix[r1], matrix[r2]] = [matrix[r2], matrix[r1]];

			let output = '\\xrightarrow{\\text{swap rows ' + (r1+1) + ' and ' + (r2+1) + '}} & ';
			output += matrix_4x2_to_latex(matrix);
			output += '\\\\';
			return output;
		}
		let invert_row = function(matrix, r) {
			matrix[r] = matrix[r].map( entry => -entry );

			let output = '\\xrightarrow{\\text{invert row ' + (r+1) + '}} &';
			output += matrix_4x2_to_latex(matrix);
			output += '\\\\';
			return output;
		}
		let subtract_row = function(matrix, r_unchanged, r_changed, numTimes) {
			matrix[r_changed] = matrix[r_changed].map((entry, index) =>
				entry - matrix[r_unchanged][index]*numTimes
			);

			let output = '\\xrightarrow{\\text{subtract row ' + (r_unchanged+1) + ' from row ' + (r_changed+1);
			if (numTimes > 1){
				output += ', ' + numTimes + ' times}} &';
			} else {
				output += '}} &';
			}
			output += matrix_4x2_to_latex(matrix);
			output += '\\\\';
			return output;
		}

		let output = '$$\\begin{aligned}';
		output += matrix_4x2_to_latex(array_elements);

		const NUM_ROWS = 4;
		const NUM_COLS = 2;

		let pivotColumn = 0;
		let pivotRow = 0;
		while (pivotColumn < NUM_COLS) {
			// first, make sure that either the pivot row is nonzero or all relevant rows are zero (in this column)
			if (array_elements[pivotRow][pivotColumn] === 0){
				for (let newPivotRow = pivotRow + 1; newPivotRow < NUM_ROWS; newPivotRow++) {
					if (array_elements[newPivotRow][pivotColumn] !== 0) {
						output += swap_rows(array_elements, pivotRow, newPivotRow);
						break;
					}
				}
				// if even after all that we're still zero, then the entire column is zero
				// skip the rest of the calculation for this column
				if (array_elements[pivotRow][pivotColumn] === 0){
					pivotColumn++;
					continue;
				}
			}

			// swap negatives: row pivotRow
			if (array_elements[pivotRow][pivotColumn] < 0) {
				output += invert_row(array_elements, pivotRow);
			}

			// now do Euclid's algorithm
			for (let r = pivotRow + 1; r < NUM_ROWS; r++ ) {
				// swap negatives: row r
				if (array_elements[r][pivotColumn] < 0) {
					output += invert_row(array_elements, r);
				}
				while(array_elements[pivotRow][pivotColumn] !== 0 && array_elements[r][pivotColumn] !== 0) {
					if (array_elements[pivotRow][pivotColumn] <= array_elements[r][pivotColumn]) {
						let numTimes = Math.floor(array_elements[r][pivotColumn] / array_elements[pivotRow][pivotColumn]);
						output += subtract_row(array_elements, pivotRow, r, numTimes);
					} else {
						let numTimes = Math.floor(array_elements[pivotRow][pivotColumn] / array_elements[r][pivotColumn]);
						output += subtract_row(array_elements, r, pivotRow, numTimes);
					}
				}

				if (array_elements[pivotRow][pivotColumn] === 0) {
					output += swap_rows(array_elements, pivotRow, r);
				}
			}

			pivotRow++;
			pivotColumn++;
		}

		output += '\\end{aligned}$$';
		let output_div = document.getElementById('symmetric_output');
		output_div.innerHTML = output;
		MathJax.typeset();

		let originalPieceBtn = document.createElement('button');
		originalPieceBtn.innerHTML = 'Custom Piece';
		originalPieceBtn.addEventListener('click', function(event){
			let movement = array_ids.map(row =>
				row.map( id =>
					parseInt(document.getElementById(id).value)
				)
			).concat(array_ids.map(row =>
				row.map( id =>
					-parseInt(document.getElementById(id).value)
				)
			));

			thePiece.moves = movement;
			mainBoard.resetAll();
			mainBoard.addPiece(thePiece, zeroRow, zeroCol);
			mainBoard.setSelectedTile(zeroRow, zeroCol);
			mainBoard.updateDomToMatchState();
		});
		output_div.appendChild(originalPieceBtn);


		let reducedPieceBtn = document.createElement('button');
		reducedPieceBtn.innerHTML = 'Reduced Piece';
		reducedPieceBtn.addEventListener('click', function(event){
			let movement = array_elements.concat(
				array_elements.map(row => row.map( id => -id))
			);

			thePiece.moves = movement;
			mainBoard.resetAll();
			mainBoard.addPiece(thePiece, zeroRow, zeroCol);
			mainBoard.setSelectedTile(zeroRow, zeroCol);
			mainBoard.updateDomToMatchState();
		});
		output_div.appendChild(reducedPieceBtn);
	});
	
</script>
</div>


</body>
</html>